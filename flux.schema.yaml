# --- Project Configuration ---
- name: project.organization
  type: string
  required: true
  description: "Organization name for SCM operations"
  discover:
    command: |
      gh api graphql -f query='
        { viewer { organizations(first: 50) { nodes { login name } } } }
      '
    parse: |
      {{- range .data.viewer.organizations.nodes -}}
      {{ .name }} ({{ .login }})|{{ .login }}
      {{ end -}}
    prompt: select

- name: project.id
  type: string
  description: "Default project board"
  discover:
    command: |
      gh api graphql -f query='
        query($org: String!) {
          organization(login: $org) {
            projectsV2(first: 50, orderBy: {field: UPDATED_AT, direction: DESC}) {
              nodes { id number title closed }
            }
          }
        }
      ' -f org='{{.project.organization}}'
    parse: |
      {{- range .data.organization.projectsV2.nodes -}}
      {{- if not .closed -}}
      {{ .title }} (#{{ .number }})|{{ .id }}|{{ .title }}|{{ .number }}
      {{ end -}}
      {{- end -}}
    also_sets:
      project.board: 0
      project.number: 1
    prompt: select

# --- Ore Models ---
- name: ore.status.enabled
  type: bool
  description: "Enable Status ore model (track issue lifecycle)"
  default: "false"

- name: ore.status.field_id
  type: string
  description: "GitHub Project field ID for Status"
  discover:
    command: |
      gh api graphql -f query='
        query($org: String!, $number: Int!) {
          organization(login: $org) {
            projectV2(number: $number) {
              fields(first: 50) {
                nodes {
                  ... on ProjectV2SingleSelectField { id name fieldType: dataType }
                }
              }
            }
          }
        }
      ' -f org='{{.project.organization}}' -F number={{.project.number}}
    parse: |
      {{- range .data.organization.projectV2.fields.nodes -}}
      {{- if .name -}}
      {{ .name }} ({{ .fieldType }})|{{ .id }}
      {{ end -}}
      {{- end -}}
    prompt: select

- name: ore.priority.enabled
  type: bool
  description: "Enable Priority ore model (P0-P3 ranking)"
  default: "false"

- name: ore.priority.field_id
  type: string
  description: "GitHub Project field ID for Priority"
  discover:
    command: |
      gh api graphql -f query='
        query($org: String!, $number: Int!) {
          organization(login: $org) {
            projectV2(number: $number) {
              fields(first: 50) {
                nodes {
                  ... on ProjectV2SingleSelectField { id name fieldType: dataType }
                }
              }
            }
          }
        }
      ' -f org='{{.project.organization}}' -F number={{.project.number}}
    parse: |
      {{- range .data.organization.projectV2.fields.nodes -}}
      {{- if .name -}}
      {{ .name }} ({{ .fieldType }})|{{ .id }}
      {{ end -}}
      {{- end -}}
    prompt: select

- name: ore.iteration.enabled
  type: bool
  description: "Enable Iteration ore model (sprint/cycle tracking)"
  default: "false"

- name: ore.iteration.field_id
  type: string
  description: "GitHub Project field ID for Iteration"
  discover:
    command: |
      gh api graphql -f query='
        query($org: String!, $number: Int!) {
          organization(login: $org) {
            projectV2(number: $number) {
              fields(first: 50) {
                nodes {
                  ... on ProjectV2IterationField { id name fieldType: dataType }
                  ... on ProjectV2SingleSelectField { id name fieldType: dataType }
                }
              }
            }
          }
        }
      ' -f org='{{.project.organization}}' -F number={{.project.number}}
    parse: |
      {{- range .data.organization.projectV2.fields.nodes -}}
      {{- if .name -}}
      {{ .name }} ({{ .fieldType }})|{{ .id }}
      {{ end -}}
      {{- end -}}
    prompt: select
